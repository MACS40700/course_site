<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Visualizations and the Grammar of Graphics</title>
    <meta charset="utf-8" />
    <meta name="author" content="MACSS 40700   University of Chicago" />
    <script src="index_files/header-attrs/header-attrs.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Visualizations and the Grammar of Graphics
]
.author[
### MACSS 40700 <br /> University of Chicago
]

---






class: inverse, middle

# Why visualize data?

---

class: center, middle

Consider the following 13 datasets:


| ID| `\(N\)`| `\(\bar{X}\)`| `\(\bar{Y}\)`| `\(\sigma_{X}\)`| `\(\sigma_{Y}\)`|        `\(R\)`|
|--:|---:|---------:|---------:|------------:|------------:|----------:|
|  1| 142|  54.26610|  47.83472|     16.76983|     26.93974| -0.0641284|
|  2| 142|  54.26873|  47.83082|     16.76924|     26.93573| -0.0685864|
|  3| 142|  54.26732|  47.83772|     16.76001|     26.93004| -0.0683434|
|  4| 142|  54.26327|  47.83225|     16.76514|     26.93540| -0.0644719|
|  5| 142|  54.26030|  47.83983|     16.76774|     26.93019| -0.0603414|
|  6| 142|  54.26144|  47.83025|     16.76590|     26.93988| -0.0617148|
|  7| 142|  54.26881|  47.83545|     16.76670|     26.94000| -0.0685042|
|  8| 142|  54.26785|  47.83590|     16.76676|     26.93610| -0.0689797|
|  9| 142|  54.26588|  47.83150|     16.76885|     26.93861| -0.0686092|
| 10| 142|  54.26734|  47.83955|     16.76896|     26.93027| -0.0629611|
| 11| 142|  54.26993|  47.83699|     16.76996|     26.93768| -0.0694456|
| 12| 142|  54.26692|  47.83160|     16.77000|     26.93790| -0.0665752|
| 13| 142|  54.26015|  47.83972|     16.76996|     26.93000| -0.0655833|

---

class: center, middle

If we estimate linear regression models for each dataset, we obtain virtually identical coefficients, again suggesting the relationships are identical

&lt;img src="index_files/figure-html/datasaurus-lm-1.png" width="80%" style="display: block; margin: auto;" /&gt;

---

class: center, middle

But what happens if we draw a picture?

&lt;img src="index_files/figure-html/datasaurus-graph-1.gif" width="90%" style="display: block; margin: auto;" /&gt;

---

class: center, middle

These 13 datasets have the same summary statistics, yet they are drastically different in appearance!

&lt;img src="index_files/figure-html/datasaurus-graph-static-1.png" width="90%" style="display: block; margin: auto;" /&gt;

---

class: inverse, middle

# The Grammar of Graphics

---

## Grammar and Grammar of Graphics

&gt; A **Grammar** can be broadly defined as the whole system and structure of a language or of languages in general, usually taken as consisting of syntax and morphology (including inflections) and sometimes also phonology and semantics. It what makes communication possible


&gt; Applied to visualizations, a **Grammar of Graphics** is a grammar that makes it possibile to create a wide range of statistical graphics!

---

### Grammar of Graphics

* A grammar used to create a wide range of statistical graphics

* Grammar of graphics approach: implemented in **[`ggplot2`](https://cran.r-project.org/web/packages/ggplot2/index.html)**, a widely used graphics library for R

* ggplot2 is part of the **[`tidyverse`](https://www.tidyverse.org/)** a collection of R packages designed for data science that share the same grammar and data structures. We will learn how to use multiple packages from tidyverse in this course.

---

class: inverse, middle

# Main components of the Grammar of Graphics

&gt; Go to "The Grammar of Graphics" notes in our website to follow along


---

# Grammar of Graphics: the layer cake approach 
.footnote[*Thanks to Jennifer Lin for this metaphor*]
* graph layer +
* data layer + 
* label layer + 
* theme layer + 
* other layer + 



---

# Data: Gapminder and other data
Gapminder data cover multiple countries over multiple years and include information on life expectancy and population. This is one of multiple 'sample' datasets available for R (others including iris and mtcars). It's neat because to use it, you can just call `install.packages("gapminder")` and then `data(gapminder)`. 

---

# Basic graph: preloaded data

Let's start with mtcars (you will see MANY EXAMPLES using this on stackoverflow). In a fresh Rmd file, create a code chunk that calls `data(mtcars)`


```r
data(mtcars)
head(mtcars)
```

```
##                    mpg cyl disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4
## Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1
## Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1
## Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2
## Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1
```

---

# Where we're going: graph somewhat prettiness

&lt;img src="index_files/figure-html/unnamed-chunk-2-1.png" width="80%" style="display: block; margin: auto;" /&gt;

---
  
# ggplot layer
  This layer sets up the graph itself. Note that if you just set the data, as I do here, you basically get a blank slate. 
  
--
  I have told it what I want for the data and my respective axes but I haven't actually plotted anything yet!

```r
ggplot(mtcars, aes(x = mpg, y = wt))
```

&lt;img src="index_files/figure-html/unnamed-chunk-3-1.png" width="50%" style="display: block; margin: auto;" /&gt;

---
# graph layer
  Then, we just add each element with a `+` after. Here, we have a few options for how we want the "things" on the graph to appear. Option 1: points. (note, there are multiple ways we could choose to set this up).
  

```r
ggplot(mtcars, aes(x = mpg, y = wt)) +
       geom_point()
```

&lt;img src="index_files/figure-html/unnamed-chunk-4-1.png" width="50%" style="display: block; margin: auto;" /&gt;

---
# graph layer
  Then, we just add each element with a `+` after. Here, we have a few options for how we want the "things" on the graph to appear. Option 2: text (note, there are multiple ways we could choose to set this up).
  

```r
ggplot(mtcars, aes(x = mpg, y = wt)) +
       geom_text(label = rownames(mtcars), check_overlap = TRUE) 
```

&lt;img src="index_files/figure-html/unnamed-chunk-5-1.png" width="50%" style="display: block; margin: auto;" /&gt;


---

# points (intermediate / advanced) layer (back to points!)
Here, we can see our points colored by different criteria. 


```r
ggplot(mtcars)+ 
       geom_point(aes(x = mpg, y = wt, 
                      color = factor(cyl),
                      shape = factor(cyl),
                      size = hp)) 
```

&lt;img src="index_files/figure-html/unnamed-chunk-6-1.png" width="50%" style="display: block; margin: auto;" /&gt;


---

# label layer 


```r
ggplot(mtcars)+ 
       geom_point(aes(x = mpg, y = wt, 
                      color = factor(cyl),
                      shape = factor(cyl),
                      size = hp))+ 
  labs(title = "Car MPG vs weight", 
       x = 'Miles per gallon',
       y = 'Car weight',
       shape="Cylinders", size="Horsepower", color = "Cylinders",
       caption = "Source: mtcars")
```

&lt;img src="index_files/figure-html/unnamed-chunk-7-1.png" width="50%" style="display: block; margin: auto;" /&gt;

---
  
# theme layer


```r
ggplot(mtcars)+ 
       geom_point(aes(x = mpg, y = wt, 
                      color = factor(cyl),
                      shape = factor(cyl),
                      size = hp))+ 
  labs(title = "Car MPG vs weight", 
       x = 'Miles per gallon',
       y = 'Car weight',
       shape="Cylinders", size="Horsepower", color = "Cylinders",
       caption = "Source: mtcars") +
  theme_bw()
```

&lt;img src="index_files/figure-html/unnamed-chunk-8-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---
  
# others


```r
ggplot(mtcars)+ 
       geom_point(aes(x = mpg, y = wt, 
                      color = factor(cyl),
                      shape = factor(cyl),
                      size = hp))+ 
  labs(title = "Car MPG vs weight", 
       x = 'Miles per gallon',
       y = 'Car weight',
       shape="Cylinders", size="Horsepower", color = "Cylinders",
       caption = "Source: mtcars") +
  theme_bw() +
  scale_color_manual(values = c("black", "gray", "blue") ) 
```

&lt;img src="index_files/figure-html/unnamed-chunk-9-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---
  
# Final version!

.pull-left[


```r
ggplot(mtcars)+ 
       geom_point(aes(x = mpg, y = wt, 
                      color = factor(cyl),
                      shape = factor(cyl),
                      size = hp))+ 
  labs(title = "Car MPG vs weight", 
       x = 'Miles per gallon',
       y = 'Car weight',
       shape="Cylinders", size="Horsepower", color = "Cylinders",
       caption = "Source: mtcars") +
  theme_bw() +
  scale_color_manual(values = c("black", "gray", "blue") ) 
```

]


.pull-right[
&lt;img src="index_files/figure-html/unnamed-chunk-11-1.png" width="90%" style="display: block; margin: auto;" /&gt;
]
---
  
# Basic graph: gapminder 
  

&gt;  Which is the best name for our dataset?    
   a) df or dat    
   b) gapminder   
   c) gapminder_2007   
   d) (something else)   
 

---
  
# Basic graph: gapminder 

(NOTE: BAD CODE (why?))  

```r
data(gapminder) # note: not necessary but this will have it show up in your environment like with 'regular' data
```

--

### Why is this code better? 

```r
data(gapminder) # note: not necessary but this will 
                                # have it show up in your environment 
                                # like with 'regular' data
```

--

Now, use yesterday's skills to explore the dataset. What might make a good `x' or 'y'? 

--- 

---

# Exercise: Gapminder

&lt;img src="index_files/figure-html/gapminder-over-time-1.gif" width="60%" style="display: block; margin: auto;" /&gt;

---

# Acknowledgments 

The content of these slides is derived in part from Sabrina Nardin's and Benjamin Soltoff’s “Computing for the Social Sciences” course materials, licensed under the CC BY NC 4.0 Creative Commons License. Any errors or oversights are mine alone.

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "magula",
"highlightLines": true,
"highlightLanguage": "r",
"ratio": "16:9",
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
